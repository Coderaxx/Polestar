<form class="homey-form" id="loginForm">
    <fieldset class="homey-form-fieldset">
        <legend class="homey-form-legend"><span data-i18n="Polestar2.pair.title"></span></legend>

        <div class="homey-form-group">
            <label class="homey-form-label" for="email"><span data-i18n="Polestar2.pair.email"></span></label>
            <input class="homey-form-input" id="email" type="text" value="" />
        </div>
        <div class="homey-form-group">
            <label class="homey-form-label" for="password"><span data-i18n="Polestar2.pair.password"></span></label>
            <input class="homey-form-input" id="password" type="password" value="" />
        </div>
        <div class="homey-form-group">
            <button class="homey-button homey-button-primary" id="loginButton" type="button"><span
                    data-i18n="Polestar2.pair.loginButton"></span></button>
    </fieldset>
</form>
<script type="application/javascript">
    Homey.setTitle(Homey.__("Polestar 2"));

    $(document).ready(function () {
        Homey.emit('getLoginDetails').then(function (result) {
            //console.log(result);
            if (result && result.success) {
                $('#email').val(result.email) || '';
                $('#password').val(result.password) || '';

                return $('#loginButton').click();
            }
        });
    });

    $('#loginButton').click(function () {
        Homey.showLoadingOverlay();
        var loginData = {
            email: $('#email').val(),
            password: $('#password').val()
        };
        Homey.emit('login', loginData).then(function (result) {
            Homey.hideLoadingOverlay();
            //console.log(result);
            if (result.error) {
                console.log('Login failed');
                Homey.alert(Homey.__("Polestar2.pair.loginFailed"));
                return Homey.setNavigationClose();
            } else {
                console.log("Tibber login successful");
                return Homey.nextView();
            }
        });
    });
</script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>